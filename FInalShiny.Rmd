---
title: "Pokemon Tournament Analysis"
author: "Jackson Marsh and Mario Rodriguez"
date: "2024-12-11"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
      theme: yeti
---

```{r}
#| echo: false
library(tidyverse)
library(flexdashboard)
library(ggthemes)
library(shinyWidgets)
```

```{r}
#| echo: false
TypeChart <- read_csv("Data/TypeChart.csv")
national_dex <- read_csv("Data/national_dex_forms.csv")
tournament_results <- read_csv("Data/tournament_results_forms.csv")
```

```{r}
#| echo: false
type_colors <- c("#9fa19f", "#f08500", "#8eb7f2", "#8b3ecf", "#89531a", "#adaa7e",
               "#92a200", "#6b4172", "#6ea0b9", "#d63624", "#497cf3", "#54a113",
               "#f8d800", "#df497a", "#6ed6ff", "#595ce5", "#494949", "#f0a6d6"
               )
names(type_colors) = c("normal", "fighting", "flying", "poison", "ground", "rock",
                       "bug", "ghost", "steel", "fire", "water", "grass",
                       "electric", "psychic", "ice", "dragon", "dark", "fairy")
```

Pokemon Stats
==========================
```{r}
inputPanel(
  selectInput("stat", label = "Key Statistic:",
              choices = c("Health points" = "hp","Attack" = "attack","Defense" = "defense", "Special Attack" = "sp_atk","Special Defense" = "sp_def","Speed" = "speed"))
)
```

Row 
-------------------------

```{r}
renderTable({
  national_dex %>%
  arrange(desc(.data[[input$stat]])) %>%
  slice_head(n = 10) %>%
  select(name, .data[[input$stat]])
})
```

```{r}
renderPlot({
national_dex %>%
  pivot_longer(type1:type2, names_to = NULL, values_to = "type" ) %>%
  filter(!is.na(type)) %>%
  count(type, sort = T) %>%
  ggplot(aes(x = type, y = n, fill = type)) +
  geom_col() + 
  scale_fill_manual(values = type_colors)  + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Frequency of each type across all pokemon", x = "Type", y = "Frequency")
})
```

```{r}
inputPanel(
  sliderInput("adjust", label = "Adjustment:",
              min = 3, max = 18, value = 1, step = 1)
)
renderTable({
national_dex %>%
  mutate(num_characters = nchar(name)) %>%
  arrange(desc(num_characters)) %>%
  filter(num_characters == input$adjust) %>%
  select(name, num_characters)
})
```


Most Commonly Used Pokemon
==========================

Row 
-------------------------

```{r}
#| echo: false
inputPanel(
  selectInput(inputId = "type", 
              label = "Type: ", 
              choices = c("overall", "normal", "fighting", "flying", "poison", "ground", "rock",
                       "bug", "ghost", "steel", "fire", "water", "grass",
                       "electric", "psychic", "ice", "dragon", "dark", "fairy"),
              selected = "overall"
  )
)

renderPlot({
  tournament_results |> 
  left_join(national_dex, join_by(pokemon, alt_form_name == alt_form)) |>
  count(pokemon, name, type1, type2) %>%
  {if(input$type != "overall") filter(., type1 == input$type | type2 == input$type) else .} |>  
  slice_max(n, n = 25) |> 
  mutate(name = fct_reorder(name, n)) |> 
  ggplot(aes(x = name, y = n), fill = input$type) + 
  geom_col() +
  coord_flip()
})

```

Test 2
======================

```{r}
#| echo: false
inputPanel(
  selectInput("stat", label = "Key Statistic:",
              choices = c("Health points" = "hp","Attack" = "attack","Defense" = "defense", "Special Attack" = "sp_atk","Special Defense" = "sp_def","Speed" = "speed"))
)
```

Row 
-------------------------

```{r, echo=FALSE}
renderPlot({  
  tournament_results |> 
  left_join(national_dex, join_by(pokemon, alt_form_name == alt_form)) %>% 
  group_by(player) %>%
  mutate(sum = sum(.data[[input$stat]])) %>%
  slice_head() %>%
  ggplot(aes(x = player, y = sum)) + 
  geom_col() + 
  geom_hline(yintercept = mean(national_dex[[input$stat]]) * 6, color = "red") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
})
```

Weaknesses 
======================

```{r}
tournament_results |> 
  left_join(national_dex, join_by(pokemon, alt_form_name == alt_form)) |> 
  pivot_longer(type1:type2, names_to = NULL, values_to = "type" ) |> 
  filter(!is.na(type), placement <= 10) |> 
  mutate(type = fct_infreq(type))
  
```


